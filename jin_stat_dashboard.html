<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>ì§„ - ìŠ¤íƒ¯ ì—… ëŒ€ì‹œë³´ë“œ</title>
  <style>
    :root{
      --bg:#0b0c10; --card:rgba(255,255,255,.06); --line:rgba(255,255,255,.12);
      --txt:#eaf0ff; --muted:rgba(234,240,255,.75);
      --good:#34d399; --info:#60a5fa; --warn:#fbbf24; --bad:#fb7185;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--txt);font-family:system-ui,-apple-system,"Segoe UI",sans-serif}
    .wrap{max-width:980px;margin:0 auto;padding:22px}
    .top{display:flex;gap:12px;flex-wrap:wrap;align-items:flex-start;justify-content:space-between}
    h1{margin:0;font-size:22px;letter-spacing:-.02em}
    .sub{margin:6px 0 0;color:var(--muted);line-height:1.45}
    .tag{display:inline-block;padding:6px 12px;border-radius:999px;border:1px solid var(--line);
      background:rgba(255,255,255,.06);font-size:12px;font-weight:800;opacity:.95}
    .grid{display:grid;grid-template-columns:1.2fr .8fr;gap:14px;margin-top:14px}
    @media (max-width:880px){.grid{grid-template-columns:1fr}}
    .card{background:var(--card);border:1px solid var(--line);border-radius:18px;padding:16px;box-shadow:0 20px 60px rgba(0,0,0,.35)}
    .row{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .big{font-size:44px;font-weight:900;letter-spacing:-.02em;margin:10px 0 6px}
    .pill{display:flex;align-items:center;justify-content:space-between;gap:10px;padding:12px 14px;border-radius:14px;
      background:rgba(255,255,255,.06);border:1px solid var(--line)}
    .pill b{font-size:14px}
    .pill span{font-variant-numeric:tabular-nums;color:rgba(234,240,255,.9)}
    .bar{height:10px;border-radius:999px;background:rgba(255,255,255,.10);overflow:hidden;border:1px solid var(--line)}
    .bar>div{height:100%;width:0%;background:linear-gradient(90deg,var(--good),var(--info));transition:width .2s ease}
    button{
      border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.08);color:var(--txt);
      padding:12px 14px;border-radius:14px;font-weight:800;cursor:pointer;user-select:none;
      transition:transform .06s ease, background .2s ease, border-color .2s ease;
    }
    button:hover{background:rgba(255,255,255,.12)}
    button:active{transform:scale(.985)}
    .primary{background:linear-gradient(135deg, rgba(110,231,183,.22), rgba(59,130,246,.22));border-color:rgba(147,197,253,.35)}
    .danger{border-color:rgba(251,113,133,.35);background:rgba(251,113,133,.10)}
    .tiny{font-size:12px;color:rgba(234,240,255,.65);line-height:1.5;margin-top:10px}
    input, textarea, select{
      width:100%; padding:10px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.18);
      background:rgba(0,0,0,.25); color:var(--txt); outline:none;
    }
    input:focus, textarea:focus, select:focus{border-color:rgba(147,197,253,.55)}
    label.check{display:flex;gap:10px;align-items:center;margin:8px 0;padding:10px 12px;border-radius:14px;
      border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.04);cursor:pointer}
    label.check:hover{background:rgba(255,255,255,.06)}
    label.check input{width:auto}
    .log{height:240px;overflow:auto;padding:12px 14px;border-radius:14px;background:rgba(255,255,255,.04);
      border:1px solid rgba(255,255,255,.10);font-size:13px;line-height:1.45}
    .sep{height:1px;background:rgba(255,255,255,.10);margin:12px 0}
    .kpi{display:grid;gap:10px}
    .hl{color:var(--good);font-weight:900}
    .warn{color:var(--warn);font-weight:900}
    .shake{animation:pop .14s ease}
    @keyframes pop{from{transform:scale(1)}to{transform:scale(1.02)}}
    a{color:#93c5fd}
  </style>
</head>
<body>
  <div class="wrap">
    <div class="top">
      <div>
        <h1>ğŸ§  ì§„ì˜ ìŠ¤íƒ¯ ì—… ëŒ€ì‹œë³´ë“œ</h1>
        <div class="sub">
          ì˜¤ëŠ˜ì˜ â€œë¯¸ë‹ˆ ìŠ¹ë¦¬â€ë¥¼ ì²´í¬í•˜ë©´ XPê°€ ìŒ“ì´ê³  ë ˆë²¨ì´ ì˜¤ë¥¸ë‹¤ ğŸ˜<br/>
          (ì €ì¥: ì´ ë¸Œë¼ìš°ì €ì— ìë™ ì €ì¥ / ìƒˆë¡œê³ ì¹¨í•´ë„ ìœ ì§€)
        </div>
      </div>
      <div class="tag" id="modeTag">DAY: -</div>
    </div>

    <div class="grid">
      <!-- LEFT -->
      <div class="card">
        <div class="row" style="justify-content:space-between;align-items:flex-end;">
          <div>
            <div style="color:var(--muted);font-weight:800;">í˜„ì¬ ë ˆë²¨</div>
            <div class="big" id="lvl">1</div>
          </div>
          <div style="text-align:right;">
            <div style="color:var(--muted);font-weight:800;">XP</div>
            <div style="font-size:26px;font-weight:900;" id="xp">0</div>
          </div>
        </div>

        <div style="margin-top:8px;">
          <div class="row" style="justify-content:space-between;color:var(--muted);font-size:12px;">
            <span id="xpNow">0</span>
            <span id="xpNeed">10</span>
          </div>
          <div class="bar"><div id="barFill"></div></div>
        </div>

        <div class="sep"></div>

        <div class="row" style="gap:10px;align-items:flex-start;">
          <div style="flex:1;min-width:260px;">
            <div style="font-weight:900;margin-bottom:8px;">âœ… ì˜¤ëŠ˜ í€˜ìŠ¤íŠ¸</div>
            <div id="quests"></div>
            <div class="tiny">TIP: ì²´í¬ í•˜ë‚˜ = XP. â€œì™„ë²½â€ì´ ì•„ë‹ˆë¼ â€œì§„í–‰â€ì´ ìŠ¹ë¦¬ì•¼ ğŸ™‚</div>
          </div>

          <div style="flex:1;min-width:260px;">
            <div style="font-weight:900;margin-bottom:8px;">ğŸ“Œ ì˜¤ëŠ˜ ì…ë ¥</div>

            <div class="row" style="gap:8px;">
              <div style="flex:1">
                <div style="font-size:12px;color:var(--muted);font-weight:800;margin:0 0 6px;">ì²´ì¤‘(kg)</div>
                <input id="weight" inputmode="decimal" placeholder="ì˜ˆ: 81.0"/>
              </div>
              <div style="width:140px">
                <div style="font-size:12px;color:var(--muted);font-weight:800;margin:0 0 6px;">ê¸°ë¶„</div>
                <select id="mood">
                  <option value="ğŸ™‚ ì•ˆì •">ğŸ™‚ ì•ˆì •</option>
                  <option value="ğŸ˜ ë³´í†µ">ğŸ˜ ë³´í†µ</option>
                  <option value="ğŸ˜£ ë¶ˆì•ˆ">ğŸ˜£ ë¶ˆì•ˆ</option>
                  <option value="ğŸ˜ ìì‹ ê°">ğŸ˜ ìì‹ ê°</option>
                </select>
              </div>
            </div>

            <div style="margin-top:10px">
              <div style="font-size:12px;color:var(--muted);font-weight:800;margin:0 0 6px;">í•œ ì¤„ ë©”ëª¨</div>
              <textarea id="note" rows="3" placeholder="ì˜ˆ: ì˜¤ëŠ˜ì€ â€˜íŒì—…ì°½ ë„ê¸°â€™ ì„±ê³µ. í”¼ê³¤í•¨ ì¤„ì—ˆìŒ."></textarea>
            </div>

            <div class="row" style="margin-top:10px;">
              <button class="primary" id="saveDay">ğŸ’¾ ì˜¤ëŠ˜ ì €ì¥</button>
              <button id="rewardBtn">ğŸ ì˜¤ëŠ˜ ë³´ìƒ</button>
              <button class="danger" id="resetToday">ğŸ—‘ï¸ ì˜¤ëŠ˜ ì´ˆê¸°í™”</button>
            </div>

            <div class="tiny">
              â€œì˜¤ëŠ˜ ì €ì¥â€ì€ ì²´ì¤‘/ë©”ëª¨ë¥¼ ê¸°ë¡ì— ë‚¨ê²¨ì¤˜. ë³´ìƒì€ í•˜ë£¨ 1ë²ˆë§Œ ê°€ëŠ¥.
            </div>
          </div>
        </div>
      </div>

      <!-- RIGHT -->
      <div class="kpi">
        <div class="card">
          <div class="row" style="justify-content:space-between;align-items:center;">
            <div style="font-weight:900;">ğŸ“Š ìƒíƒœíŒ</div>
            <div class="tag" id="streakTag">STREAK: 0</div>
          </div>

          <div style="margin-top:12px" class="pill"><b>ì—°ì†ì¼(ì¶œì„)</b><span id="streak">0</span></div>
          <div class="pill"><b>ì˜¤ëŠ˜ ì ìˆ˜</b><span id="score">0 / 0</span></div>
          <div class="pill"><b>ì˜¤ëŠ˜ ì²´ì¤‘</b><span id="weightShow">-</span></div>
          <div class="pill"><b>ê¸°ë¶„</b><span id="moodShow">-</span></div>

          <div class="sep"></div>

          <div class="row">
            <button id="exportBtn">â¬‡ï¸ CSV ë‚´ë³´ë‚´ê¸°</button>
            <button id="hardReset" class="danger">â˜ ï¸ ì „ì²´ ë¦¬ì…‹</button>
          </div>

          <div class="tiny">
            CSVëŠ” â€œì¼ì/ì²´í¬/ì²´ì¤‘/ë©”ëª¨â€ ê¸°ë¡ ë°±ì—…ìš©ì´ì•¼.
          </div>
        </div>

        <div class="card">
          <div style="font-weight:900;margin-bottom:8px;">ğŸ“œ ë¡œê·¸</div>
          <div class="log" id="log"></div>
          <div class="tiny">â€» ë¡œê·¸ëŠ” ìµœê·¼ 80ì¤„ê¹Œì§€ë§Œ ë³´ê´€</div>
        </div>
      </div>
    </div>
  </div>

<script>
  // ===== Config (ì§„ ìŠ¤íƒ€ì¼ ê¸°ë³¸ í€˜ìŠ¤íŠ¸) =====
  const QUESTS = [
    { key: "protein2", label: "ë‹¨ë°±ì§ˆ 2ë²ˆ âœ…", xp: 8 },
    { key: "steps6000", label: "6,000ë³´ âœ…", xp: 8 },
    { key: "noFries", label: "ë²„ê±° ë¨¹ì–´ë„ ê°íŠ€ X âœ…", xp: 6 },
    { key: "meds", label: "ì•½ ì±™ê²¨ë¨¹ê¸° âœ…", xp: 7 },
    { key: "brush", label: "ì–‘ì¹˜(ìµœì†Œ 1íšŒ) âœ…", xp: 5 },
    { key: "ram", label: "RAM ë¹„ìš°ê¸°(ì¢…ì´/íŒì—… ë„ê¸°) âœ…", xp: 7 },
  ];

  const KEY = "jin_stat_dashboard_v1";

  const today = () => new Date().toISOString().slice(0,10); // YYYY-MM-DD

  const defaultState = () => ({
    lvl: 1,
    xp: 0,
    streak: 0,
    lastActiveDate: "",
    rewardDate: "",
    logs: ["ğŸ¬ ì‹œì‘! ì˜¤ëŠ˜ í€˜ìŠ¤íŠ¸ ì²´í¬ë¡œ ë¯¸ë‹ˆ ìŠ¹ë¦¬ë¥¼ ìŒ“ì."],
    // records: { "YYYY-MM-DD": { checks:{}, weight:"", mood:"", note:"", savedAt:"" } }
    records: {}
  });

  let s = load();

  // ===== Helpers =====
  function save(){ localStorage.setItem(KEY, JSON.stringify(s)); }
  function load(){
    try{
      const raw = localStorage.getItem(KEY);
      if(!raw) return defaultState();
      const obj = JSON.parse(raw);
      return { ...defaultState(), ...obj };
    }catch{ return defaultState(); }
  }
  function addLog(msg){
    const t = new Date().toLocaleTimeString();
    s.logs.unshift(`[${t}] ${msg}`);
    s.logs = s.logs.slice(0, 80);
  }
  function needForLevel(lvl){ return Math.floor(18 + (lvl-1)*8); } // ëŠë¦¬ì§€ë§Œ ê¾¸ì¤€íˆ
  function escapeHtml(str){
    return String(str)
      .replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
      .replaceAll('"',"&quot;").replaceAll("'","&#039;");
  }
  function ensureTodayRecord(){
    const d = today();
    if(!s.records[d]){
      s.records[d] = { checks:{}, weight:"", mood:"ğŸ™‚ ì•ˆì •", note:"", savedAt:"" };
    }
    // ëˆ„ë½ í‚¤ ë³´ì •
    for(const q of QUESTS){
      if(typeof s.records[d].checks[q.key] !== "boolean") s.records[d].checks[q.key] = false;
    }
    return s.records[d];
  }

  function todayScore(rec){
    const total = QUESTS.length;
    const done = QUESTS.filter(q => rec.checks[q.key]).length;
    return { done, total };
  }

  function gainXP(amount, reason){
    s.xp += amount;
    addLog(`âœ¨ XP +${amount} (${reason})`);
    levelUpIfNeeded();
    save();
  }

  function levelUpIfNeeded(){
    while(s.xp >= needForLevel(s.lvl)){
      s.xp -= needForLevel(s.lvl);
      s.lvl += 1;
      addLog(`ğŸ†™ ë ˆë²¨ì—…! Lv.${s.lvl} ë‹¬ì„±`);
    }
  }

  function updateStreakOnSave(){
    const d = today();
    if(s.lastActiveDate === d) return; // ì˜¤ëŠ˜ ì´ë¯¸ ì²˜ë¦¬ë¨

    if(!s.lastActiveDate){
      s.streak = 1;
    } else {
      const prev = new Date(s.lastActiveDate);
      const cur = new Date(d);
      const diffDays = Math.round((cur - prev) / (1000*60*60*24));
      if(diffDays === 1) s.streak += 1;
      else s.streak = 1;
    }
    s.lastActiveDate = d;
    addLog(`ğŸ“… ì¶œì„ ì²˜ë¦¬! ì—°ì†ì¼: ${s.streak}`);
  }

  // ===== UI =====
  const $ = (id) => document.getElementById(id);
  const el = {
    modeTag: $("modeTag"),
    lvl: $("lvl"),
    xp: $("xp"),
    xpNow: $("xpNow"),
    xpNeed: $("xpNeed"),
    barFill: $("barFill"),
    quests: $("quests"),
    weight: $("weight"),
    mood: $("mood"),
    note: $("note"),
    saveDay: $("saveDay"),
    rewardBtn: $("rewardBtn"),
    resetToday: $("resetToday"),
    streak: $("streak"),
    streakTag: $("streakTag"),
    score: $("score"),
    weightShow: $("weightShow"),
    moodShow: $("moodShow"),
    log: $("log"),
    exportBtn: $("exportBtn"),
    hardReset: $("hardReset"),
  };

  function render(){
    const d = today();
    el.modeTag.textContent = `DAY: ${d}`;
    const rec = ensureTodayRecord();

    // quests
    el.quests.innerHTML = QUESTS.map(q => {
      const checked = rec.checks[q.key] ? "checked" : "";
      return `
        <label class="check">
          <input type="checkbox" data-key="${q.key}" ${checked}/>
          <div style="flex:1">
            <div style="font-weight:900">${escapeHtml(q.label)}</div>
            <div style="font-size:12px;color:var(--muted)">XP +${q.xp}</div>
          </div>
        </label>
      `;
    }).join("");

    // top stats
    const need = needForLevel(s.lvl);
    const pct = Math.max(0, Math.min(100, (s.xp / need) * 100));
    el.lvl.textContent = s.lvl;
    el.xp.textContent = s.xp;
    el.xpNow.textContent = s.xp;
    el.xpNeed.textContent = need;
    el.barFill.style.width = pct + "%";

    // inputs
    el.weight.value = rec.weight || "";
    el.mood.value = rec.mood || "ğŸ™‚ ì•ˆì •";
    el.note.value = rec.note || "";

    // right stats
    el.streak.textContent = s.streak;
    el.streakTag.textContent = `STREAK: ${s.streak}`;
    const sc = todayScore(rec);
    el.score.innerHTML = `<span class="${sc.done===sc.total ? 'hl' : sc.done>=Math.ceil(sc.total*0.6) ? 'warn' : ''}">${sc.done} / ${sc.total}</span>`;
    el.weightShow.textContent = rec.weight ? `${rec.weight} kg` : "-";
    el.moodShow.textContent = rec.mood || "-";

    // reward status
    const gotRewardToday = (s.rewardDate === d);
    el.rewardBtn.textContent = gotRewardToday ? "ğŸ ì˜¤ëŠ˜ ë³´ìƒ(ìˆ˜ë ¹)" : "ğŸ ì˜¤ëŠ˜ ë³´ìƒ";
    if(gotRewardToday) el.rewardBtn.classList.add("shake"); else el.rewardBtn.classList.remove("shake");

    // log
    el.log.innerHTML = s.logs.map(line => `<div>${escapeHtml(line)}</div>`).join("");

    wire();
    save();
  }

  // ì´ë²¤íŠ¸ëŠ” ì¤‘ë³µ ë°©ì§€ ìœ„í•´ í•œë²ˆë§Œ ì—°ê²°
  let wired = false;
  function wire(){
    if(wired) return;
    wired = true;

    // ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
    document.addEventListener("change", (e) => {
      const t = e.target;
      if(!(t && t.matches('input[type="checkbox"][data-key]'))) return;

      const rec = ensureTodayRecord();
      const key = t.getAttribute("data-key");
      const q = QUESTS.find(x => x.key === key);
      const before = rec.checks[key];

      rec.checks[key] = t.checked;

      // ì²´í¬í•  ë•Œë§Œ XP ì§€ê¸‰(í•´ì œëŠ” XP íšŒìˆ˜ ì•ˆ í•¨: ë„íŒŒë¯¼ ìš°ì„  ğŸ˜)
      if(!before && t.checked && q){
        gainXP(q.xp, `í€˜ìŠ¤íŠ¸ ì™„ë£Œ: ${q.label}`);
      } else {
        addLog(`ğŸ“ ì²´í¬ ë³€ê²½: ${q ? q.label : key} = ${t.checked ? "ON" : "OFF"}`);
        save();
      }
      render();
    });

    el.saveDay.addEventListener("click", () => {
      const rec = ensureTodayRecord();
      rec.weight = el.weight.value.trim();
      rec.mood = el.mood.value;
      rec.note = el.note.value.trim();
      rec.savedAt = new Date().toISOString();

      updateStreakOnSave();

      // ì €ì¥ ë³´ë„ˆìŠ¤ XP (í•˜ë£¨ 1íšŒ)
      const d = today();
      const flagKey = "_savedBonus";
      if(!rec[flagKey]){
        rec[flagKey] = true;
        gainXP(6, "ì˜¤ëŠ˜ ì €ì¥ ë³´ë„ˆìŠ¤");
      } else {
        addLog("ğŸ’¾ ì˜¤ëŠ˜ ì €ì¥ ì™„ë£Œ(ë³´ë„ˆìŠ¤ëŠ” ì´ë¯¸ ìˆ˜ë ¹)");
        save();
      }

      render();
    });

    el.rewardBtn.addEventListener("click", () => {
      const d = today();
      if(s.rewardDate === d){
        addLog("ğŸ ì˜¤ëŠ˜ ë³´ìƒì€ ì´ë¯¸ ë°›ì•˜ì–´.");
        render();
        return;
      }
      s.rewardDate = d;

      // ë³´ìƒ ë¡œì§: ì²´í¬ ê¸°ë°˜ + ëœë¤
      const rec = ensureTodayRecord();
      const sc = todayScore(rec);
      const base = 5 + sc.done * 2;           // ì²´í¬ ë§ì´ í• ìˆ˜ë¡ ë³´ìƒ ì¦ê°€
      const rand = Math.floor(Math.random()*10); // 0~9
      const total = base + rand;

      gainXP(total, `ì˜¤ëŠ˜ ë³´ìƒ (ê¸°ë³¸ ${base} + ëœë¤ ${rand})`);
      addLog(`ğŸ‰ ë³´ìƒ ìˆ˜ë ¹! ì˜¤ëŠ˜ ì ìˆ˜ ${sc.done}/${sc.total}`);
      render();
    });

    el.resetToday.addEventListener("click", () => {
      if(!confirm("ì˜¤ëŠ˜ ê¸°ë¡(ì²´í¬/ì²´ì¤‘/ë©”ëª¨)ë§Œ ì´ˆê¸°í™”í• ê¹Œ? XP/ë ˆë²¨ì€ ìœ ì§€ë¼.")) return;
      const d = today();
      s.records[d] = { checks:{}, weight:"", mood:"ğŸ™‚ ì•ˆì •", note:"", savedAt:"" };
      // ì²´í¬ í‚¤ ë³´ì •
      ensureTodayRecord();
      addLog("ğŸ—‘ï¸ ì˜¤ëŠ˜ ê¸°ë¡ ì´ˆê¸°í™” ì™„ë£Œ");
      save();
      render();
    });

    el.exportBtn.addEventListener("click", () => {
      // CSV: date, checks_done, total, weight, mood, note
      const rows = [["date","checks_done","checks_total","weight","mood","note"]];
      const dates = Object.keys(s.records).sort();
      for(const d of dates){
        const rec = s.records[d];
        if(!rec) continue;
        const done = QUESTS.filter(q => rec.checks && rec.checks[q.key]).length;
        const total = QUESTS.length;
        rows.push([
          d,
          String(done),
          String(total),
          (rec.weight || ""),
          (rec.mood || ""),
          (rec.note || "").replaceAll("\n"," ").trim()
        ]);
      }
      const csv = rows.map(r => r.map(cell => {
        const v = String(cell ?? "");
        // CSV escape
        return /[",\n]/.test(v) ? `"${v.replaceAll('"','""')}"` : v;
      }).join(",")).join("\n");

      const blob = new Blob([csv], { type: "text/csv;charset=utf-8" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = `jin_stat_export_${today()}.csv`;
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);

      addLog("â¬‡ï¸ CSV ë‚´ë³´ë‚´ê¸° ì™„ë£Œ");
      render();
    });

    el.hardReset.addEventListener("click", () => {
      if(!confirm("ì „ì²´ ë¦¬ì…‹(ë ˆë²¨/XP/ê¸°ë¡ ì „ë¶€ ì‚­ì œ)í• ê¹Œ? ì§„ì§œë¡œ?")) return;
      if(!confirm("ë§ˆì§€ë§‰ í™•ì¸: ë˜ëŒë¦´ ìˆ˜ ì—†ì–´. ê·¸ë˜ë„ í• ê¹Œ?")) return;
      localStorage.removeItem(KEY);
      s = defaultState();
      addLog("â˜ ï¸ ì „ì²´ ë¦¬ì…‹ ì™„ë£Œ. ìƒˆ ê²Œì„ ì‹œì‘!");
      render();
    });
  }

  // first render
  render();
</script>
</body>
</html>
